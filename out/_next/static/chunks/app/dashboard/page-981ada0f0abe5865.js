(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[105],{210:(e,a,l)=>{Promise.resolve().then(l.bind(l,4879))},4879:(e,a,l)=>{"use strict";l.r(a),l.d(a,{default:()=>n});var t=l(5155),r=l(2115),s=l(7383),o=l(3464);function n(){let[e,a]=(0,r.useState)(null),[l,n]=(0,r.useState)({username:"",gold:0,gems:0,level:1,profilePic:null}),[d,i]=(0,r.useState)(!1),[c,u]=(0,r.useState)(null),[m,g]=(0,r.useState)(!1),p=(e,a)=>{n(l=>({...l,[e]:a}))},h="https://nodejs-server-for-unity3dgame-login-5vxc.onrender.com/u3d/getGameDataSecured";(0,r.useEffect)(()=>{let e=s.A.get("token");e&&o.A.post("https://nodejs-server-for-unity3dgame-login-5vxc.onrender.com/u3d/autoLogin",{},{headers:{Authorization:"Bearer ".concat(e)}}).then(async l=>{if(0===l.data.code){let t=l.data.newToken;t&&s.A.set("token",t,{expires:7});let r=await o.A.get(h,{headers:{Authorization:"Bearer ".concat(t||e)}});0===r.data.code?(a(r.data.userData),n(r.data.userData)):alert("Failed to fetch game data")}else alert("Auto login failed. Please log in again."),s.A.remove("token")}).catch(e=>{console.error("Auto-login or fetch failed:",e),s.A.remove("token")})},[]);let v=async()=>{if(null==l?void 0:l.username){i(!0);try{let e=await o.A.put("https://nodejs-server-for-unity3dgame-login-5vxc.onrender.com/u3d/saveGameData",{username:l.username,gameData:{gold:l.gold||0,gems:l.gems||0,level:l.level||1}});0===e.data.code?(alert("Game data saved successfully!"),a({...l})):alert("Failed to save data.")}catch(e){console.error("Save error:",e),alert("Error saving game data.")}finally{i(!1)}}},f=async()=>{if(!c)return;g(!0);let e=s.A.get("token"),l=new FormData;l.append("image",c);try{await o.A.post("https://nodejs-server-for-unity3dgame-login-5vxc.onrender.com/u3d/uploadProfilePictureWeb",l,{headers:{Authorization:"Bearer ".concat(e),"Content-Type":"multipart/form-data"}}),alert("Profile picture uploaded!");let t=await o.A.get(h,{headers:{Authorization:"Bearer ".concat(e)}});0===t.data.code&&(a(t.data.userData),n(t.data.userData))}catch(e){console.error("Upload error:",e),alert("Error uploading image.")}finally{g(!1),u(null)}};return l?(0,t.jsxs)("div",{className:"p-8 max-w-lg mx-auto space-y-4",children:[(0,t.jsxs)("h2",{className:"text-xl font-bold",children:["Welcome, ",l.username]}),l.profilePic?(0,t.jsx)("img",{src:l.profilePic,alt:"Profile",className:"w-32 h-32 rounded-full"}):(0,t.jsx)("div",{className:"text-gray-500",children:"No profile picture uploaded"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block font-semibold",children:"Gold:"}),(0,t.jsx)("input",{type:"number",value:Number.isFinite(l.gold)?l.gold:0,onChange:e=>p("gold",parseInt(e.target.value)||0),className:"border rounded px-2 py-1 w-full"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block font-semibold",children:"Gems:"}),(0,t.jsx)("input",{type:"number",value:Number.isFinite(l.gems)?l.gems:0,onChange:e=>p("gems",parseInt(e.target.value)||0),className:"border rounded px-2 py-1 w-full"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block font-semibold",children:"Level:"}),(0,t.jsx)("input",{type:"number",value:Number.isFinite(l.level)?l.level:1,onChange:e=>p("level",parseInt(e.target.value)||1),className:"border rounded px-2 py-1 w-full"})]}),(0,t.jsx)("button",{onClick:v,disabled:d,className:"bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600",children:d?"Saving...":"Save Changes"}),(0,t.jsxs)("div",{className:"mt-6",children:[(0,t.jsx)("label",{className:"block font-semibold mb-1",children:"Upload Profile Picture:"}),(0,t.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{var a;let l=null==(a=e.target.files)?void 0:a[0];l&&l.size<=204800?u(l):alert("Image must be 200KB or less.")},className:"mb-2"}),(0,t.jsx)("button",{onClick:f,disabled:m||!c,className:"bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600",children:m?"Uploading...":"Upload Image"})]})]}):(0,t.jsx)("div",{className:"p-8",children:"Loading..."})}}},e=>{var a=a=>e(e.s=a);e.O(0,[122,441,684,358],()=>a(210)),_N_E=e.O()}]);